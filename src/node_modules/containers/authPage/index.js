import React, { useState } from 'react';
import { Link } from 'react-router-dom';
import { auth } from '../../firebaseConfig';
import {
  createUserWithEmailAndPassword,
  onAuthStateChanged,
  signInWithEmailAndPassword,
  signOut,
} from 'firebase/auth';


const AuthPage = () => {

  onAuthStateChanged(auth, (currentUser) => {
    setUser(currentUser);
  });

  const [registerEmail, setRegisterEmail] = useState('');
  const [registerPassword, setRegisterPassword] = useState('');
  const [loginEmail, setLoginEmail] = useState('');
  const [loginPassword, setLoginPassword] = useState('');

  const [user, setUser] = useState({})

  const register = async () => {
    try {
      const user = await createUserWithEmailAndPassword(
        auth,
        registerEmail,
        registerPassword
      );
      console.log(user);
    } catch (error) {
      console.log(error.message);
    }
  }

  const login = async () => {
    try {
      const user = await signInWithEmailAndPassword(
        auth,
        loginEmail,
        loginPassword
      );
      console.log(user);
    } catch (error) {
      console.log(error.message);
    }
  }

  const logout = async () => {
    await signOut(auth)
  }

  return (
    <div className='loginForm'>
      <div className='itemForm'>
        <h3>Регистрация</h3>
        <input
          type='email'
          placeholder='Email'
          onChange={(event) => { setRegisterEmail(event.target.value) }}
        />
        <input
          className='mb5'
          type='password'
          placeholder='Password'
          onChange={(event) => { setRegisterPassword(event.target.value) }}
        />
        <button onClick={register}>Создать учетную запись</button>
      </div>
      <div className='itemForm'>
        <h3>Авторизация</h3>
        <input
          type='email'
          placeholder='Email'
          onChange={(event) => { setLoginEmail(event.target.value) }}
        />
        <input
          className='mb5'
          type='password'
          placeholder='Password'
          onChange={(event) => { setLoginPassword(event.target.value) }}
        />
        <button onClick={login}>Авторизоваться</button>
        <h3>Авторизован пользователь:</h3>
        <span className='mb5'>{user?.email}</span>
        <button
          className='mb20'
          onClick={logout}
        >
          Выйти
        </button>
        <Link to='/'>
          <button>Вернуться в магазин</button>
        </Link>
      </div>
    </div>
  )
}

export default AuthPage;
